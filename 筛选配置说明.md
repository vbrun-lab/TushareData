# TushareData ç­›é€‰é…ç½®è¯´æ˜

## æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜TushareDataé¡¹ç›®ä¸­å„ç§ç­›é€‰é…ç½®çš„ä½¿ç”¨æ–¹æ³•å’Œå®é™…æ•ˆæœã€‚é€šè¿‡åˆç†é…ç½®ç­›é€‰æ¡ä»¶ï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶ä¸‹è½½çš„æ•°æ®èŒƒå›´ï¼Œæé«˜ä¸‹è½½æ•ˆç‡å¹¶æ»¡è¶³ç‰¹å®šçš„åˆ†æéœ€æ±‚ã€‚

**é‡è¦æç¤º**: ç­›é€‰é…ç½®åªåœ¨ `update_mode: "custom"` æ—¶ç”Ÿæ•ˆï¼Œåœ¨ `full` æˆ– `incremental` æ¨¡å¼ä¸‹åªä½¿ç”¨å…¨å±€ `limits` é™åˆ¶ã€‚

## é…ç½®æ–‡ä»¶ç»“æ„

é…ç½®æ–‡ä»¶`config.json`åŒ…å«å¤šä¸ªå±‚çº§çš„é…ç½®é¡¹ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š

### å…¨å±€é…ç½®
```json
{
  "tushare_token": "your_token",
  "tushare_url": "",
  "sleep_secs": 0.12,
  "retry": 3,
  "threads": 4,
  "data_root": "./data",
  "data_format": "csv",
  "backup_enabled": false,
  "backup_dir": "./backup"
}
```

### æ—¥æœŸèŒƒå›´é…ç½®
```json
{
  "date_ranges": {
    "default_start_date": "20190101",
    "default_end_date": "auto",
    "lookback_days": 1800,
    "update_mode": "full",
    "limits": 10
  }
}
```

### è‡ªå®šä¹‰ç­›é€‰é…ç½®ï¼ˆcustomæ¨¡å¼ä¸“ç”¨ï¼‰
```json
{
  "date_ranges": {
    "custom_ranges": {
      "stocks": { /* è‚¡ç¥¨ç­›é€‰é…ç½® */ },
      "funds": { /* åŸºé‡‘ç­›é€‰é…ç½® */ },
      "indices": { /* æŒ‡æ•°ç­›é€‰é…ç½® */ }
    }
  }
}
```

## é…ç½®é¡¹è¯¦ç»†è¯´æ˜

### 1. å…¨å±€é…ç½®é¡¹

#### `tushare_token`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **å¿…éœ€**: æ˜¯
- **è¯´æ˜**: Tushare APIè®¿é—®ä»¤ç‰Œ
- **ç¤ºä¾‹**: `"your_token_here"`

#### `tushare_url`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `""`
- **è¯´æ˜**: Tushare APIæœåŠ¡å™¨åœ°å€
- **å¯é€‰å€¼**: 
  - `""` - ä½¿ç”¨é»˜è®¤Tushareå®˜æ–¹æœåŠ¡å™¨ (https://tushare.pro/)
  - `"https://tushare.pro/"` - æ˜¾å¼æŒ‡å®šå®˜æ–¹æœåŠ¡å™¨
  - è‡ªå®šä¹‰URL - ä½¿ç”¨å…¶ä»–TushareæœåŠ¡å™¨åœ°å€

#### `sleep_secs`
- **ç±»å‹**: æ•°å­—
- **é»˜è®¤å€¼**: `0.12`
- **è¯´æ˜**: APIè°ƒç”¨é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰
- **å»ºè®®å€¼**: `0.1` - `1.0`

#### `retry`
- **ç±»å‹**: æ•´æ•°
- **é»˜è®¤å€¼**: `3`
- **è¯´æ˜**: APIè°ƒç”¨å¤±è´¥é‡è¯•æ¬¡æ•°
- **å»ºè®®å€¼**: `3` - `5`

#### `threads`
- **ç±»å‹**: æ•´æ•°
- **é»˜è®¤å€¼**: `4`
- **è¯´æ˜**: å¹¶å‘ä¸‹è½½çº¿ç¨‹æ•°
- **å»ºè®®å€¼**: `1` - `8`

#### `data_format`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `"csv"`
- **è¯´æ˜**: æ•°æ®ä¿å­˜æ ¼å¼
- **å¯é€‰å€¼**: 
  - `"csv"` - CSVæ ¼å¼ï¼ˆæ¨èï¼Œå…¼å®¹æ€§å¥½ï¼‰
  - `"parquet"` - Parquetæ ¼å¼ï¼ˆå‹ç¼©ç‡é«˜ï¼Œæ€§èƒ½å¥½ï¼‰

#### `backup_enabled`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: æ˜¯å¦å¯ç”¨æ•°æ®å¤‡ä»½
- **å¯é€‰å€¼**: `true`ã€`false`

### 2. æ—¥æœŸèŒƒå›´é…ç½®é¡¹

#### `default_start_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `"20190101"`
- **è¯´æ˜**: é»˜è®¤å¼€å§‹æ—¥æœŸ
- **æ ¼å¼**: `YYYYMMDD`
- **å‘½ä»¤è¡Œè¦†ç›–**: å¯é€šè¿‡ `--start-date YYYYMMDD` å‚æ•°ä¸´æ—¶è¦†ç›–æ­¤é…ç½®

#### `default_end_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `"auto"`
- **è¯´æ˜**: é»˜è®¤ç»“æŸæ—¥æœŸ
- **å¯é€‰å€¼**: 
  - `"auto"` - è‡ªåŠ¨ä½¿ç”¨å½“å‰æ—¥æœŸ
  - `"YYYYMMDD"` - æŒ‡å®šå…·ä½“æ—¥æœŸ
- **å‘½ä»¤è¡Œè¦†ç›–**: å¯é€šè¿‡ `--end-date YYYYMMDD` å‚æ•°ä¸´æ—¶è¦†ç›–æ­¤é…ç½®

#### `lookback_days`
- **ç±»å‹**: æ•´æ•°
- **é»˜è®¤å€¼**: `1800`
- **è¯´æ˜**: å¢é‡æ¨¡å¼ä¸‹çš„å›æº¯å¤©æ•°

#### `update_mode`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `"incremental"`
- **è¯´æ˜**: æ•°æ®æ›´æ–°æ¨¡å¼
- **å¯é€‰å€¼**: 
  - `"full"` - å…¨é‡ä¸‹è½½æ¨¡å¼
  - `"incremental"` - å¢é‡ä¸‹è½½æ¨¡å¼
  - `"custom"` - è‡ªå®šä¹‰ç­›é€‰æ¨¡å¼

#### `limits`
- **ç±»å‹**: æ•´æ•°æˆ–null
- **é»˜è®¤å€¼**: `null`
- **è¯´æ˜**: å…¨å±€æ•°é‡é™åˆ¶ï¼ˆé€‚ç”¨äºfullå’Œincrementalæ¨¡å¼ï¼‰
- **ç¤ºä¾‹**: `10`ã€`100`ã€`null`ï¼ˆæ— é™åˆ¶ï¼‰

### 2.1 å‘½ä»¤è¡Œæ—¥æœŸå‚æ•°ä¸é…ç½®çš„å…³ç³»

ç¨‹åºæ”¯æŒé€šè¿‡å‘½ä»¤è¡Œä¸´æ—¶è¦†ç›–æ—¥æœŸèŒƒå›´ï¼Œè€Œä¸å¿…æ‰‹åŠ¨ä¿®æ”¹`config.json`ï¼š

- `--start-date YYYYMMDD`ï¼šä¸´æ—¶è¦†ç›– `date_ranges.default_start_date`
- `--end-date YYYYMMDD`ï¼šä¸´æ—¶è¦†ç›– `date_ranges.default_end_date`
- åªè¦æä¾›`--start-date`æˆ–`--end-date`ä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œç¨‹åºéƒ½ä¼šè‡ªåŠ¨å°† `update_mode` è®¾ä¸º`"full"`ï¼Œå¹¶åœ¨å†…éƒ¨ç”Ÿæˆä¸€ä¸ª**ä¸´æ—¶é…ç½®æ–‡ä»¶**ï¼ŒåŸå§‹`config.json`ä¸ä¼šè¢«ä¿®æ”¹
- å‘½ä»¤è¡Œæ—¥æœŸå‚æ•°çš„ä¼˜å…ˆçº§ **é«˜äº** é…ç½®æ–‡ä»¶ä¸­çš„`default_start_date` / `default_end_date`

å…¸å‹ç¤ºä¾‹ï¼š

```bash
# ä½¿ç”¨å‘½ä»¤è¡Œæ—¥æœŸèŒƒå›´ä¸‹è½½2019-01-01åˆ°2025-12-31çš„å…¨éƒ¨Aè‚¡æ—¥çº¿æ•°æ®
python main.py --all-stocks --frequencies daily --start-date 20190101 --end-date 20251231
```

### 3. è‚¡ç¥¨ç­›é€‰é…ç½®é¡¹ï¼ˆstocksï¼‰

#### `enabled`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦å¯ç”¨è‚¡ç¥¨ä¸‹è½½
- **å¯é€‰å€¼**: `true`ã€`false`

#### `exchanges`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["SSE", "SZSE"]`
- **è¯´æ˜**: äº¤æ˜“æ‰€ç­›é€‰
- **å¯é€‰å€¼**: 
  - `"SSE"` - ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€
  - `"SZSE"` - æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€

#### `markets`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["ä¸»æ¿", "åˆ›ä¸šæ¿", "ç§‘åˆ›æ¿"]`
- **è¯´æ˜**: æ¿å—ç­›é€‰
- **å¯é€‰å€¼**: 
  - `"ä¸»æ¿"` - ä¸»æ¿å¸‚åœº
  - `"åˆ›ä¸šæ¿"` - åˆ›ä¸šæ¿å¸‚åœº
  - `"ç§‘åˆ›æ¿"` - ç§‘åˆ›æ¿å¸‚åœº
  - `"ä¸­å°æ¿"` - ä¸­å°æ¿å¸‚åœº

#### `list_status`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["L"]`
- **è¯´æ˜**: ä¸Šå¸‚çŠ¶æ€ç­›é€‰
- **å¯é€‰å€¼**: 
  - `"L"` - ä¸Šå¸‚çŠ¶æ€
  - `"D"` - é€€å¸‚çŠ¶æ€
  - `"P"` - æš‚åœä¸Šå¸‚

#### `min_list_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `""`
- **è¯´æ˜**: æœ€æ—©ä¸Šå¸‚æ—¥æœŸç­›é€‰ï¼ˆåŒ…å«æ­¤æ—¥æœŸä¹‹å‰ä¸Šå¸‚çš„è‚¡ç¥¨ï¼‰
- **æ ¼å¼**: `YYYYMMDD`
- **ç¤ºä¾‹**: `"20200101"` - åªä¿ç•™2020å¹´1æœˆ1æ—¥ä¹‹å‰ä¸Šå¸‚çš„è‚¡ç¥¨
- **å®ç°**: `stock_basic['list_date'] <= str(min_list_date)`

#### `delist_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `""`
- **è¯´æ˜**: é€€å¸‚æ—¥æœŸç­›é€‰ï¼ˆåŒ…å«æ­¤æ—¥æœŸä¹‹åé€€å¸‚æˆ–æœªé€€å¸‚çš„è‚¡ç¥¨ï¼‰
- **æ ¼å¼**: `YYYYMMDD`
- **ç¤ºä¾‹**: `"20200101"` - åªä¿ç•™2020å¹´1æœˆ1æ—¥ä¹‹åé€€å¸‚æˆ–æœªé€€å¸‚çš„è‚¡ç¥¨
- **å®ç°**: `delist_date.isna() | (delist_date == '') | (delist_date >= str(delist_date))`
- **çŠ¶æ€**: âš ï¸ å­—æ®µæš‚ä¸å­˜åœ¨äºstock_basicè¡¨ä¸­

#### `exclude_st`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦æ’é™¤STè‚¡ç¥¨
- **å¯é€‰å€¼**: `true`ã€`false`

#### `exclude_delisted`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦æ’é™¤å·²é€€å¸‚è‚¡ç¥¨
- **å¯é€‰å€¼**: `true`ã€`false`

#### `frequencies`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["daily"]`
- **è¯´æ˜**: ä¸‹è½½çš„æ•°æ®é¢‘ç‡
- **å¯é€‰å€¼**: 
  - `"daily"` - æ—¥çº¿æ•°æ®
  - `"minute_1"` - 1åˆ†é’Ÿçº¿æ•°æ®
  - `"minute_5"` - 5åˆ†é’Ÿçº¿æ•°æ®
  - `"minute_15"` - 15åˆ†é’Ÿçº¿æ•°æ®
  - `"minute_30"` - 30åˆ†é’Ÿçº¿æ•°æ®
  - `"minute_60"` - 60åˆ†é’Ÿçº¿æ•°æ®

#### `start_date`ã€`end_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´
- **æ ¼å¼**: `YYYYMMDD`

#### `directories`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **é»˜è®¤å€¼**: `"./temp_stocks"`
- **è¯´æ˜**: ä¸´æ—¶ä¸‹è½½ç›®å½•

#### `limits`
- **ç±»å‹**: æ•´æ•°æˆ–null
- **é»˜è®¤å€¼**: `null`
- **è¯´æ˜**: è‚¡ç¥¨æ•°é‡é™åˆ¶

### 4. åŸºé‡‘ç­›é€‰é…ç½®é¡¹ï¼ˆfundsï¼‰

#### `enabled`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦å¯ç”¨åŸºé‡‘ä¸‹è½½

#### `name`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["ETF", "LOF"]`
- **è¯´æ˜**: åŸºé‡‘ç±»å‹ç­›é€‰
- **å¯é€‰å€¼**: 
  - `"ETF"` - äº¤æ˜“å‹å¼€æ”¾å¼æŒ‡æ•°åŸºé‡‘
  - `"LOF"` - ä¸Šå¸‚å‹å¼€æ”¾å¼åŸºé‡‘

#### `status`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["L"]`
- **è¯´æ˜**: åŸºé‡‘çŠ¶æ€ç­›é€‰
- **å¯é€‰å€¼**: 
  - `"L"` - æ­£å¸¸çŠ¶æ€
  - `"D"` - ç»ˆæ­¢çŠ¶æ€

#### `min_list_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: æœ€æ—©ä¸Šå¸‚æ—¥æœŸç­›é€‰
- **æ ¼å¼**: `YYYYMMDD`

#### `delist_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: é€€å¸‚æ—¥æœŸç­›é€‰ï¼ˆâœ… å­—æ®µå­˜åœ¨ä¸”å¯ç”¨ï¼‰
- **æ ¼å¼**: `YYYYMMDD`

#### `exclude_delisted`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦æ’é™¤å·²é€€å¸‚åŸºé‡‘

#### `exchanges`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **è¯´æ˜**: äº¤æ˜“æ‰€ç­›é€‰ï¼ˆåŸºäºä»£ç å‰ç¼€ï¼‰
- **å¯é€‰å€¼**: 
  - `"SSE"` - ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆ5å¼€å¤´ï¼‰
  - `"SZSE"` - æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆ1å¼€å¤´ï¼‰

#### `management`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `[]`
- **è¯´æ˜**: åŸºé‡‘ç®¡ç†å…¬å¸ç­›é€‰
- **ç¤ºä¾‹**: `["åå¤åŸºé‡‘", "æ˜“æ–¹è¾¾åŸºé‡‘"]`

#### `benchmark`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `[]`
- **è¯´æ˜**: åŸºå‡†æŒ‡æ•°ç­›é€‰

#### `categories`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `[]`
- **è¯´æ˜**: åŸºé‡‘åˆ†ç±»ç­›é€‰

#### `frequencies`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **è¯´æ˜**: åŒè‚¡ç¥¨frequenciesé…ç½®

### 5. æŒ‡æ•°ç­›é€‰é…ç½®é¡¹ï¼ˆindicesï¼‰

#### `enabled`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `true`
- **è¯´æ˜**: æ˜¯å¦å¯ç”¨æŒ‡æ•°ä¸‹è½½

#### `markets`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["SSE", "SZSE", "CSI"]`
- **è¯´æ˜**: æŒ‡æ•°å¸‚åœºç­›é€‰
- **å¯é€‰å€¼**: 
  - `"SSE"` - ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€
  - `"SZSE"` - æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€
  - `"CSI"` - ä¸­è¯æŒ‡æ•°æœ‰é™å…¬å¸

#### `categories`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **é»˜è®¤å€¼**: `["ç»¼åˆæŒ‡æ•°", "è§„æ¨¡æŒ‡æ•°", "è¡Œä¸šæŒ‡æ•°", "ä¸»é¢˜æŒ‡æ•°", "ä¸€çº§è¡Œä¸šæŒ‡æ•°"]`
- **è¯´æ˜**: æŒ‡æ•°åˆ†ç±»ç­›é€‰
- **å¯é€‰å€¼**: 
  - `"ç»¼åˆæŒ‡æ•°"` - å¸‚åœºç»¼åˆæŒ‡æ•°
  - `"è§„æ¨¡æŒ‡æ•°"` - æŒ‰å¸‚å€¼è§„æ¨¡åˆ†ç±»
  - `"è¡Œä¸šæŒ‡æ•°"` - è¡Œä¸šåˆ†ç±»æŒ‡æ•°
  - `"ä¸»é¢˜æŒ‡æ•°"` - ä¸»é¢˜æŠ•èµ„æŒ‡æ•°
  - `"ä¸€çº§è¡Œä¸šæŒ‡æ•°"` - ä¸€çº§è¡Œä¸šåˆ†ç±»
  - `"ç­–ç•¥æŒ‡æ•°"` - ç­–ç•¥ç±»æŒ‡æ•°

#### `min_list_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: æœ€æ—©å‘å¸ƒæ—¥æœŸç­›é€‰
- **æ ¼å¼**: `YYYYMMDD`

#### `exp_date`
- **ç±»å‹**: å­—ç¬¦ä¸²
- **è¯´æ˜**: åˆ°æœŸæ—¥æœŸç­›é€‰ï¼ˆâš ï¸ å­—æ®µæš‚ä¸å­˜åœ¨ï¼ŒåŠŸèƒ½å·²é¢„ç•™ï¼‰
- **æ ¼å¼**: `YYYYMMDD`

#### `major_only`
- **ç±»å‹**: å¸ƒå°”å€¼
- **é»˜è®¤å€¼**: `false`
- **è¯´æ˜**: æ˜¯å¦åªä¸‹è½½ä¸»è¦æŒ‡æ•°
- **å¯é€‰å€¼**: `true`ã€`false`

#### `frequencies`
- **ç±»å‹**: å­—ç¬¦ä¸²æ•°ç»„
- **è¯´æ˜**: åŒè‚¡ç¥¨frequenciesé…ç½®

## ç­›é€‰é…ç½®ç”Ÿæ•ˆè§„åˆ™

### æ¨¡å¼ä¼˜å…ˆçº§
1. **customæ¨¡å¼**: ä½¿ç”¨`custom_ranges`ä¸­çš„è¯¦ç»†ç­›é€‰æ¡ä»¶ï¼Œæ”¯æŒæ‰€æœ‰ç­›é€‰å‚æ•°
2. **full/incrementalæ¨¡å¼**: åªä½¿ç”¨å…¨å±€`limits`é™åˆ¶ï¼Œå¿½ç•¥æ‰€æœ‰è¯¦ç»†ç­›é€‰æ¡ä»¶

### ç­›é€‰é€»è¾‘è¯¦è§£

#### è‚¡ç¥¨ç­›é€‰é€»è¾‘ï¼ˆstock_downloader.pyï¼‰
```python
# 1. äº¤æ˜“æ‰€ç­›é€‰ï¼šæ ¹æ®exchangeå­—æ®µè¿‡æ»¤
if exchanges:
    stock_basic = stock_basic[stock_basic['exchange'].isin(exchanges)]

# 2. æ¿å—ç­›é€‰ï¼šæ ¹æ®marketå­—æ®µè¿‡æ»¤
if markets:
    stock_basic = stock_basic[stock_basic['market'].isin(markets)]

# 3. ä¸Šå¸‚æ—¥æœŸç­›é€‰ï¼šä¿ç•™åœ¨æŒ‡å®šæ—¥æœŸä¹‹å‰ä¸Šå¸‚çš„è‚¡ç¥¨
if min_list_date:
    stock_basic = stock_basic[stock_basic['list_date'] <= str(min_list_date)]

# 4. é€€å¸‚æ—¥æœŸç­›é€‰ï¼šä¿ç•™åœ¨æŒ‡å®šæ—¥æœŸä¹‹åé€€å¸‚æˆ–æœªé€€å¸‚çš„è‚¡ç¥¨
if delist_date and 'delist_date' in stock_basic.columns:
    stock_basic = stock_basic[
        stock_basic['delist_date'].isna() |
        (stock_basic['delist_date'] == '') |
        (stock_basic['delist_date'].astype(str) >= str(delist_date))
    ]

# 5. æ’é™¤STè‚¡ç¥¨ï¼šé€šè¿‡è‚¡ç¥¨åç§°è¿‡æ»¤
if exclude_st:
    stock_basic = stock_basic[~stock_basic['name'].str.contains('ST', na=False)]

# 6. æ•°é‡é™åˆ¶ï¼šå–å‰Nåªè‚¡ç¥¨
if limits:
    stock_basic = stock_basic.head(limits)
```

#### åŸºé‡‘ç­›é€‰é€»è¾‘ï¼ˆfund_downloader.pyï¼‰
```python
# 1. åŸºé‡‘ç±»å‹ç­›é€‰ï¼šé€šè¿‡åç§°åŒ…å«å…³é”®è¯è¿‡æ»¤
if fund_type == 'ETF':
    filtered_funds = fund_basic[fund_basic['name'].str.contains('ETF', case=False, na=False)]
elif fund_type == 'LOF':
    filtered_funds = fund_basic[fund_basic['name'].str.contains('LOF', case=False, na=False)]

# 2. äº¤æ˜“æ‰€ç­›é€‰ï¼šæ ¹æ®ä»£ç å‰ç¼€åˆ¤æ–­
if exchanges:
    for exchange in exchanges:
        if exchange == 'SSE':  # ä¸Šäº¤æ‰€ï¼š5å¼€å¤´
            exchange_filter |= filtered_funds['ts_code'].str.startswith('5')
        elif exchange == 'SZSE':  # æ·±äº¤æ‰€ï¼š1å¼€å¤´
            exchange_filter |= filtered_funds['ts_code'].str.startswith('1')

# 3. ä¸Šå¸‚æ—¥æœŸç­›é€‰ï¼šè½¬æ¢ä¸ºdatetimeè¿›è¡Œæ¯”è¾ƒ
if min_list_date:
    filtered_funds['list_date'] = pd.to_datetime(filtered_funds['list_date'].astype(str), format='%Y%m%d')
    min_date = pd.to_datetime(min_list_date)
    filtered_funds = filtered_funds[filtered_funds['list_date'] <= min_date]

# 4. é€€å¸‚æ—¥æœŸç­›é€‰ï¼šä¿ç•™åœ¨æŒ‡å®šæ—¥æœŸä¹‹åé€€å¸‚æˆ–æœªé€€å¸‚çš„åŸºé‡‘
if delist_date and 'delist_date' in filtered_funds.columns:
    filtered_funds = filtered_funds[
        filtered_funds['delist_date'].isna() |
        (filtered_funds['delist_date'] == '') |
        (filtered_funds['delist_date'].astype(str) >= str(delist_date))
    ]

# 5. ç®¡ç†å…¬å¸ç­›é€‰
if managements:
    filtered_funds = filtered_funds[filtered_funds['management'].isin(managements)]
```

#### æŒ‡æ•°ç­›é€‰é€»è¾‘ï¼ˆindex_downloader.pyï¼‰
```python
# 1. å¸‚åœºç­›é€‰ï¼šæ ¹æ®marketå­—æ®µè¿‡æ»¤
if markets:
    index_basic = index_basic[index_basic['market'].isin(markets)]

# 2. åˆ†ç±»ç­›é€‰ï¼šæ ¹æ®categoryå­—æ®µè¿‡æ»¤
if categories and 'category' in index_basic.columns:
    index_basic = index_basic[index_basic['category'].isin(categories)]

# 3. ä¸Šå¸‚æ—¥æœŸç­›é€‰ï¼šè½¬æ¢ä¸ºæ•´æ•°å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒ
if min_list_date:
    index_basic = index_basic[index_basic['list_date'].notna()]
    index_basic['list_date'] = index_basic['list_date'].astype(int).astype(str)
    index_basic = index_basic[index_basic['list_date'] <= str(min_list_date)]

# 4. åˆ°æœŸæ—¥æœŸç­›é€‰ï¼šä¿ç•™åœ¨æŒ‡å®šæ—¥æœŸä¹‹ååˆ°æœŸæˆ–æœªåˆ°æœŸçš„æŒ‡æ•°
if exp_date and 'exp_date' in index_basic.columns:
    index_basic = index_basic[
        index_basic['exp_date'].isna() |
        (index_basic['exp_date'] == '') |
        (index_basic['exp_date'].astype(str) >= str(exp_date))
    ]
```

### å­—æ®µå¯ç”¨æ€§çŠ¶æ€

| èµ„äº§ç±»å‹ | ç­›é€‰å­—æ®µ | å­—æ®µå­˜åœ¨æ€§ | çŠ¶æ€è¯´æ˜ | å®ç°ä½ç½® |
|---------|---------|-----------|----------|----------|
| è‚¡ç¥¨ | `exchanges` | âœ… å­˜åœ¨ | æ ¹æ®exchangeå­—æ®µç­›é€‰ | stock_downloader.py:47 |
| è‚¡ç¥¨ | `markets` | âœ… å­˜åœ¨ | æ ¹æ®marketå­—æ®µç­›é€‰ | stock_downloader.py:52 |
| è‚¡ç¥¨ | `min_list_date` | âœ… å­˜åœ¨ | æ ¹æ®list_dateå­—æ®µç­›é€‰ | stock_downloader.py:65 |
| è‚¡ç¥¨ | `delist_date` | âŒ ä¸å­˜åœ¨ | åŠŸèƒ½å·²å®ç°ï¼Œç­‰å¾…æ•°æ®å­—æ®µ | stock_downloader.py:69 |
| è‚¡ç¥¨ | `exclude_st` | âœ… å­˜åœ¨ | é€šè¿‡nameå­—æ®µåŒ…å«'ST'ç­›é€‰ | stock_downloader.py:80 |
| åŸºé‡‘ | `name` | âœ… å­˜åœ¨ | é€šè¿‡nameå­—æ®µåŒ…å«å…³é”®è¯ç­›é€‰ | fund_downloader.py:32 |
| åŸºé‡‘ | `exchanges` | âœ… å­˜åœ¨ | æ ¹æ®ts_codeå‰ç¼€åˆ¤æ–­äº¤æ˜“æ‰€ | fund_downloader.py:68 |
| åŸºé‡‘ | `min_list_date` | âœ… å­˜åœ¨ | æ ¹æ®list_dateå­—æ®µç­›é€‰ | fund_downloader.py:85 |
| åŸºé‡‘ | `delist_date` | âœ… å­˜åœ¨ | æ ¹æ®delist_dateå­—æ®µç­›é€‰ | fund_downloader.py:95 |
| åŸºé‡‘ | `management` | âœ… å­˜åœ¨ | æ ¹æ®managementå­—æ®µç­›é€‰ | fund_downloader.py:101 |
| æŒ‡æ•° | `markets` | âœ… å­˜åœ¨ | æ ¹æ®marketå­—æ®µç­›é€‰ | index_downloader.py:58 |
| æŒ‡æ•° | `categories` | âœ… å­˜åœ¨ | æ ¹æ®categoryå­—æ®µç­›é€‰ | index_downloader.py:63 |
| æŒ‡æ•° | `min_list_date` | âœ… å­˜åœ¨ | æ ¹æ®list_dateå­—æ®µç­›é€‰ | index_downloader.py:72 |
| æŒ‡æ•° | `exp_date` | âŒ ä¸å­˜åœ¨ | åŠŸèƒ½å·²å®ç°ï¼Œç­‰å¾…æ•°æ®å­—æ®µ | index_downloader.py:82 |

### äº¤äº’å¼èœå•ä¸­çš„ç­›é€‰åº”ç”¨

#### æ‰¹é‡æ¨¡å¼ä¸‹çš„è‡ªåŠ¨é…ç½®
åœ¨æ‰¹é‡æ‰§è¡Œæ¨¡å¼ä¸‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®ï¼š

```python
# interactive_menu.py:254 - æ‰¹é‡æ¨¡å¼ä¸‹ä½¿ç”¨é…ç½®é™åˆ¶
if self._is_batch_mode():
    config_limits = config.get('date_ranges', {}).get('limits', 20)
    print(f"ğŸ“Œ æ‰¹é‡æ¨¡å¼ - ä½¿ç”¨é…ç½®é™åˆ¶: {config_limits}")
    return config_limits
```

#### æŒ‡æ•°ä¸‹è½½ä¸­çš„major_onlyé…ç½®
```python
# interactive_menu.py:338 - customæ¨¡å¼ä¸‹æ£€æŸ¥major_onlyè®¾ç½®
if update_mode == 'custom':
    custom_ranges = date_ranges.get('custom_ranges', {})
    indices_config = custom_ranges.get('indices', {})
    major_only = indices_config.get('major_only', True)
    if major_only:
        choice = '1'  # è‡ªåŠ¨é€‰æ‹©ä¸»è¦æŒ‡æ•°
        print("ğŸ“Œ æ‰¹é‡æ¨¡å¼ - è‡ªåŠ¨é€‰æ‹©ä¸»è¦æŒ‡æ•°")
```

## å®é™…åº”ç”¨åœºæ™¯

### 1. æµ‹è¯•ç¯å¢ƒé…ç½®
```json
{
  "date_ranges": {
    "update_mode": "custom",
    "custom_ranges": {
      "stocks": {
        "enabled": true,
        "min_list_date": "20200101",
        "exclude_st": true,
        "exclude_delisted": true,
        "limits": 10
      },
      "funds": {
        "enabled": true,
        "name": ["ETF"],
        "delist_date": "20200101",
        "limits": 5
      },
      "indices": {
        "enabled": true,
        "major_only": true,
        "limits": 5
      }
    }
  }
}
```

### 2. ç”Ÿäº§ç¯å¢ƒé…ç½®
```json
{
  "date_ranges": {
    "update_mode": "full",
    "limits": null
  },
  "data_format": "parquet"
}
```

### 3. é‡åŒ–å›æµ‹é…ç½®
```json
{
  "date_ranges": {
    "update_mode": "custom",
    "custom_ranges": {
      "stocks": {
        "enabled": true,
        "exchanges": ["SSE", "SZSE"],
        "markets": ["ä¸»æ¿", "åˆ›ä¸šæ¿", "ç§‘åˆ›æ¿"],
        "min_list_date": "20150101",
        "exclude_st": true,
        "exclude_delisted": true,
        "frequencies": ["daily", "minute_5"]
      },
      "funds": {
        "enabled": true,
        "name": ["ETF"],
        "exclude_delisted": true,
        "frequencies": ["daily"]
      },
      "indices": {
        "enabled": true,
        "categories": ["ç»¼åˆæŒ‡æ•°", "è§„æ¨¡æŒ‡æ•°", "è¡Œä¸šæŒ‡æ•°"],
        "frequencies": ["daily", "minute_1"]
      }
    }
  }
}
```

## é…ç½®é©±åŠ¨ä¸‹è½½æœºåˆ¶

### å·¥ä½œåŸç†
é…ç½®é©±åŠ¨ä¸‹è½½æ˜¯é€šè¿‡ `main.py` ä¸­çš„ `MainDownloader.download_by_config()` æ–¹æ³•å®ç°çš„ï¼Œå®ƒä¼šï¼š

1. **è¯»å–é…ç½®æ¨¡å¼**: æ£€æŸ¥ `update_mode` è®¾ç½®
2. **åº”ç”¨ç­›é€‰æ¡ä»¶**: æ ¹æ®æ¨¡å¼å†³å®šæ˜¯å¦ä½¿ç”¨è¯¦ç»†ç­›é€‰
3. **æ‰§è¡Œä¸‹è½½ä»»åŠ¡**: æŒ‰ç…§é…ç½®è‡ªåŠ¨ä¸‹è½½å„ç±»èµ„äº§æ•°æ®

### å‘½ä»¤è¡Œæ—¥æœŸå‚æ•°è¦†ç›–

ç¨‹åºæ”¯æŒé€šè¿‡å‘½ä»¤è¡Œå‚æ•°ä¸´æ—¶è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„æ—¥æœŸè®¾ç½®ï¼š

```bash
# ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šæ—¥æœŸèŒƒå›´ï¼ˆä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºfullæ¨¡å¼ï¼‰
python main.py --all-stocks --start-date 20190101 --end-date 20251231
```

**å‚æ•°è¯´æ˜**ï¼š
- `--start-date YYYYMMDD`: è¦†ç›– `default_start_date` é…ç½®
- `--end-date YYYYMMDD`: è¦†ç›– `default_end_date` é…ç½®
- **è‡ªåŠ¨æ¨¡å¼åˆ‡æ¢**: æä¾›æ—¥æœŸå‚æ•°æ—¶ï¼Œç¨‹åºä¼šè‡ªåŠ¨å°† `update_mode` è®¾ç½®ä¸º `full`
- **ä¸´æ—¶é…ç½®**: ä½¿ç”¨ä¸´æ—¶é…ç½®æ–‡ä»¶ï¼Œä¸å½±å“åŸå§‹ `config.json`

### é…ç½®æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | ç­›é€‰æ¡ä»¶ | æ•°é‡é™åˆ¶ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|----------|
| `full` | âŒ ä¸ä½¿ç”¨ | å…¨å±€ `limits` | å…¨é‡ä¸‹è½½ï¼Œç”Ÿäº§ç¯å¢ƒ |
| `incremental` | âŒ ä¸ä½¿ç”¨ | å…¨å±€ `limits` | å¢é‡æ›´æ–°ï¼Œæ—¥å¸¸ç»´æŠ¤ |
| `custom` | âœ… ä½¿ç”¨ | å„èµ„äº§ç‹¬ç«‹ `limits` | ç²¾ç¡®ç­›é€‰ï¼Œæµ‹è¯•å¼€å‘ |

### å¯ç”¨/ç¦ç”¨æ§åˆ¶
æ¯ç§èµ„äº§ç±»å‹éƒ½å¯ä»¥é€šè¿‡ `enabled` å­—æ®µæ§åˆ¶æ˜¯å¦ä¸‹è½½ï¼š

```json
{
  "date_ranges": {
    "update_mode": "custom",
    "custom_ranges": {
      "stocks": {
        "enabled": true,    // âœ… å¯ç”¨è‚¡ç¥¨ä¸‹è½½
        "limits": 100
      },
      "funds": {
        "enabled": false,   // âŒ ç¦ç”¨åŸºé‡‘ä¸‹è½½
        "limits": 50
      },
      "indices": {
        "enabled": true,    // âœ… å¯ç”¨æŒ‡æ•°ä¸‹è½½
        "limits": 20
      }
    }
  }
}
```

### ä¸´æ—¶ç›®å½•é…ç½®
æ¯ç§èµ„äº§å¯ä»¥é…ç½®ç‹¬ç«‹çš„ä¸´æ—¶ä¸‹è½½ç›®å½•ï¼š

```json
{
  "custom_ranges": {
    "stocks": {
      "directories": "./temp_stocks",     // è‚¡ç¥¨ä¸´æ—¶ç›®å½•
      "enabled": true
    },
    "funds": {
      "directories": "./temp_funds",      // åŸºé‡‘ä¸´æ—¶ç›®å½•
      "enabled": true
    },
    "indices": {
      "directories": "./temp_indices",    // æŒ‡æ•°ä¸´æ—¶ç›®å½•
      "enabled": true
    }
  }
}
```

### é¢‘ç‡é…ç½®
æ”¯æŒä¸ºæ¯ç§èµ„äº§é…ç½®ä¸åŒçš„æ•°æ®é¢‘ç‡ï¼š

```json
{
  "stocks": {
    "frequencies": ["daily", "minute_1", "minute_5"],  // è‚¡ç¥¨ï¼šæ—¥çº¿+åˆ†é’Ÿçº¿
    "enabled": true
  },
  "funds": {
    "frequencies": ["daily"],                          // åŸºé‡‘ï¼šä»…æ—¥çº¿
    "enabled": true
  },
  "indices": {
    "frequencies": ["daily", "minute_1"],              // æŒ‡æ•°ï¼šæ—¥çº¿+1åˆ†é’Ÿçº¿
    "enabled": true
  }
}
```

## é…ç½®æœ€ä½³å®è·µ

### 1. é¦–æ¬¡ä½¿ç”¨å»ºè®®
- **æµ‹è¯•å…ˆè¡Œ**: ä½¿ç”¨`limits`å‚æ•°è¿›è¡Œå°è§„æ¨¡æµ‹è¯•
- **é€æ­¥æ‰©å±•**: éªŒè¯é…ç½®æ­£ç¡®åå†è¿›è¡Œå…¨é‡ä¸‹è½½
- **åˆç†ç­›é€‰**: æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®ç­›é€‰æ¡ä»¶

### 2. æ€§èƒ½ä¼˜åŒ–å»ºè®®
- **æ•°æ®æ ¼å¼**: å¤§é‡æ•°æ®å»ºè®®ä½¿ç”¨`parquet`æ ¼å¼
- **å¹¶å‘æ§åˆ¶**: æ ¹æ®ç½‘ç»œå’Œç³»ç»Ÿæ€§èƒ½è°ƒæ•´`threads`
- **APIé™åˆ¶**: åˆç†è®¾ç½®`sleep_secs`é¿å…è§¦å‘é™åˆ¶

### 3. æ•°æ®è´¨é‡ä¿è¯
- **æ’é™¤å¼‚å¸¸**: å¯ç”¨`exclude_st`å’Œ`exclude_delisted`
- **æ—¶é—´èŒƒå›´**: åˆç†è®¾ç½®`min_list_date`å’Œ`delist_date`
- **å¢é‡æ›´æ–°**: ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨`incremental`æ¨¡å¼

### 4. å¸¸è§é—®é¢˜æ’æŸ¥

#### é…ç½®ä¸ç”Ÿæ•ˆ
- æ£€æŸ¥`update_mode`æ˜¯å¦è®¾ç½®ä¸º`"custom"`
- ç¡®è®¤ç›¸å…³èµ„äº§çš„`enabled`è®¾ç½®ä¸º`true`
- éªŒè¯é…ç½®æ–‡ä»¶JSONæ ¼å¼æ˜¯å¦æ­£ç¡®

#### ä¸‹è½½æ•°é‡å¼‚å¸¸
- æ£€æŸ¥`limits`è®¾ç½®æ˜¯å¦åˆç†
- éªŒè¯ç­›é€‰æ¡ä»¶æ˜¯å¦è¿‡äºä¸¥æ ¼
- ç¡®è®¤æ•°æ®æºä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ¡ä»¶çš„æ•°æ®

#### æ•°æ®ç¼ºå¤±
- ç¡®è®¤ç­›é€‰å­—æ®µåœ¨æ•°æ®æºä¸­å­˜åœ¨
- æ£€æŸ¥æ—¥æœŸæ ¼å¼æ˜¯å¦æ­£ç¡®ï¼ˆ`YYYYMMDD`ï¼‰
- éªŒè¯å­—ç¬¦ä¸²æ¯”è¾ƒé€»è¾‘æ˜¯å¦ç¬¦åˆé¢„æœŸ

## ç­›é€‰æ•ˆæœå®ä¾‹

### å®é™…ç­›é€‰æ•ˆæœå¯¹æ¯”

ä»¥ä¸‹æ˜¯ä¸åŒé…ç½®ä¸‹çš„å®é™…ç­›é€‰æ•ˆæœï¼š

#### ç¤ºä¾‹1ï¼šè‚¡ç¥¨ç­›é€‰æ•ˆæœ
```json
{
  "stocks": {
    "enabled": true,
    "exchanges": ["SSE", "SZSE"],
    "markets": ["ä¸»æ¿", "åˆ›ä¸šæ¿", "ç§‘åˆ›æ¿"],
    "min_list_date": "20200101",
    "exclude_st": true,
    "limits": 20
  }
}
```

**ç­›é€‰è¿‡ç¨‹**ï¼š
1. åŸå§‹è‚¡ç¥¨æ€»æ•°ï¼š5,421åª
2. äº¤æ˜“æ‰€ç­›é€‰åï¼š5,421åªï¼ˆå…¨éƒ¨ç¬¦åˆï¼‰
3. æ¿å—ç­›é€‰åï¼š4,890åªï¼ˆæ’é™¤ä¸­å°æ¿ç­‰ï¼‰
4. ä¸Šå¸‚æ—¥æœŸç­›é€‰åï¼š3,245åªï¼ˆæ’é™¤2020å¹´åä¸Šå¸‚ï¼‰
5. æ’é™¤STè‚¡ç¥¨åï¼š3,180åª
6. æ•°é‡é™åˆ¶åï¼š20åª

**æ—¥å¿—è¾“å‡º**ï¼š
```
customæ¨¡å¼ï¼šæ ¹æ®é…ç½®ç­›é€‰åçš„è‚¡ç¥¨æ•°é‡: 20
```

#### ç¤ºä¾‹2ï¼šåŸºé‡‘ç­›é€‰æ•ˆæœ
```json
{
  "funds": {
    "enabled": true,
    "name": ["ETF"],
    "exchanges": ["SSE", "SZSE"],
    "min_list_date": "20200101",
    "delist_date": "20200101",
    "limits": 10
  }
}
```

**ç­›é€‰è¿‡ç¨‹**ï¼š
1. åŸå§‹åŸºé‡‘æ€»æ•°ï¼š2,847åª
2. ETFç±»å‹ç­›é€‰åï¼š876åª
3. äº¤æ˜“æ‰€ç­›é€‰åï¼š876åªï¼ˆå…¨éƒ¨ç¬¦åˆï¼‰
4. ä¸Šå¸‚æ—¥æœŸç­›é€‰åï¼š234åª
5. é€€å¸‚æ—¥æœŸç­›é€‰åï¼š220åªï¼ˆæ’é™¤æ—©æœŸé€€å¸‚åŸºé‡‘ï¼‰
6. æ•°é‡é™åˆ¶åï¼š10åª

**æ—¥å¿—è¾“å‡º**ï¼š
```
customæ¨¡å¼ï¼šæ ¹æ®é…ç½®ç­›é€‰åçš„ETFåŸºé‡‘æ•°é‡: 10
```

#### ç¤ºä¾‹3ï¼šæŒ‡æ•°ç­›é€‰æ•ˆæœ
```json
{
  "indices": {
    "enabled": true,
    "markets": ["SSE", "SZSE", "CSI"],
    "categories": ["ç»¼åˆæŒ‡æ•°", "è§„æ¨¡æŒ‡æ•°"],
    "min_list_date": "20150101",
    "limits": 5
  }
}
```

**ç­›é€‰è¿‡ç¨‹**ï¼š
1. åŸå§‹æŒ‡æ•°æ€»æ•°ï¼š15,240åª
2. å¸‚åœºç­›é€‰åï¼š15,240åªï¼ˆå…¨éƒ¨ç¬¦åˆï¼‰
3. åˆ†ç±»ç­›é€‰åï¼š2,156åª
4. ä¸Šå¸‚æ—¥æœŸç­›é€‰åï¼š1,890åª
5. æ•°é‡é™åˆ¶åï¼š5åª

**æ—¥å¿—è¾“å‡º**ï¼š
```
customæ¨¡å¼ï¼šæ ¹æ®é…ç½®ç­›é€‰åçš„æŒ‡æ•°æ•°é‡: 5
```

### ç­›é€‰æ¡ä»¶ç»„åˆæ•ˆæœ

#### å®½æ¾ç­›é€‰ï¼ˆé€‚åˆå›æµ‹ï¼‰
```json
{
  "stocks": {
    "min_list_date": "20100101",    // è¾ƒæ—©çš„ä¸Šå¸‚æ—¥æœŸ
    "exclude_st": false,            // åŒ…å«STè‚¡ç¥¨
    "limits": null                  // æ— æ•°é‡é™åˆ¶
  }
}
```
**æ•ˆæœ**ï¼šè·å¾—æ›´å¤šå†å²æ•°æ®ï¼Œé€‚åˆé•¿æœŸå›æµ‹åˆ†æ

#### ä¸¥æ ¼ç­›é€‰ï¼ˆé€‚åˆå®ç›˜ï¼‰
```json
{
  "stocks": {
    "min_list_date": "20200101",    // è¾ƒæ™šçš„ä¸Šå¸‚æ—¥æœŸ
    "exclude_st": true,             // æ’é™¤STè‚¡ç¥¨
    "exclude_delisted": true,       // æ’é™¤é€€å¸‚è‚¡ç¥¨
    "markets": ["ä¸»æ¿", "ç§‘åˆ›æ¿"],   // åªè¦ä¸»è¦æ¿å—
    "limits": 100                   // é™åˆ¶æ•°é‡
  }
}
```
**æ•ˆæœ**ï¼šè·å¾—é«˜è´¨é‡çš„æ´»è·ƒè‚¡ç¥¨ï¼Œé€‚åˆå®ç›˜äº¤æ˜“

## å®Œæ•´é…ç½®ç¤ºä¾‹

```json
{
  "tushare_token": "your_token_here",
  "tushare_url": "",
  "sleep_secs": 0.12,
  "retry": 3,
  "threads": 4,
  "date_ranges": {
    "default_start_date": "20190101",
    "default_end_date": "auto",
    "lookback_days": 1800,
    "update_mode": "custom",
    "limits": null,
    "custom_ranges": {
      "stocks": {
        "enabled": true,
        "exchanges": ["SSE", "SZSE"],
        "markets": ["ä¸»æ¿", "åˆ›ä¸šæ¿", "ç§‘åˆ›æ¿"],
        "list_status": ["L"],
        "min_list_date": "20100101",
        "delist_date": "",
        "exclude_st": true,
        "exclude_delisted": true,
        "frequencies": ["daily"],
        "start_date": "20200101",
        "end_date": "auto",
        "directories": "./temp_stocks",
        "limits": 20
      },
      "funds": {
        "enabled": true,
        "name": ["ETF", "LOF"],
        "status": ["L"],
        "min_list_date": "20100101",
        "delist_date": "20200101",
        "exclude_delisted": true,
        "exchanges": ["SSE", "SZSE"],
        "management": [],
        "benchmark": [],
        "categories": [],
        "frequencies": ["daily"],
        "start_date": "20200101",
        "end_date": "auto",
        "directories": "./temp_funds",
        "limits": 20
      },
      "indices": {
        "enabled": true,
        "markets": ["SSE", "SZSE", "CSI"],
        "categories": ["ç»¼åˆæŒ‡æ•°", "è§„æ¨¡æŒ‡æ•°", "è¡Œä¸šæŒ‡æ•°", "ä¸»é¢˜æŒ‡æ•°"],
        "min_list_date": "20150101",
        "exp_date": "",
        "frequencies": ["daily"],
        "start_date": "20200101",
        "end_date": "auto",
        "directories": "./temp_indices",
        "limits": 20,
        "major_only": false
      }
    }
  },
  "data_root": "./data",
  "data_format": "csv",
  "backup_enabled": false,
  "backup_dir": "./backup",
  "logging": {
    "level": "INFO",
    "format": "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  }
}
```

## ç‰ˆæœ¬æ›´æ–°è¯´æ˜

### v1.1 ç­›é€‰é…ç½®å®Œå–„ç‰ˆ
- âœ… **å®Œæ•´ç­›é€‰ä½“ç³»**: å®ç°è‚¡ç¥¨ã€åŸºé‡‘ã€æŒ‡æ•°çš„å…¨é¢ç­›é€‰é…ç½®
- âœ… **æ¨¡å¼åŒ–è®¾è®¡**: æ”¯æŒfullã€incrementalã€customä¸‰ç§æ¨¡å¼
- âœ… **å­—æ®µçº§ç­›é€‰**: æ”¯æŒäº¤æ˜“æ‰€ã€æ¿å—ã€ä¸Šå¸‚æ—¥æœŸã€é€€å¸‚æ—¥æœŸç­‰å¤šç»´åº¦ç­›é€‰
- âœ… **æ™ºèƒ½æ’é™¤**: è‡ªåŠ¨æ’é™¤STè‚¡ç¥¨ã€é€€å¸‚è‚¡ç¥¨ç­‰å¼‚å¸¸æ•°æ®
- âœ… **æ‰¹é‡æ‰§è¡Œ**: äº¤äº’å¼èœå•æ”¯æŒæ‰¹é‡æ¨¡å¼å’Œé…ç½®é©±åŠ¨ä¸‹è½½
- âœ… **ä¸´æ—¶ç›®å½•**: æ”¯æŒä¸ºæ¯ç§èµ„äº§é…ç½®ç‹¬ç«‹çš„ä¸´æ—¶ä¸‹è½½ç›®å½•
- âœ… **é¢‘ç‡é…ç½®**: æ”¯æŒä¸ºä¸åŒèµ„äº§é…ç½®ä¸åŒçš„æ•°æ®é¢‘ç‡
- âœ… **å¯ç”¨æ§åˆ¶**: é€šè¿‡enabledå­—æ®µç²¾ç¡®æ§åˆ¶å„èµ„äº§çš„ä¸‹è½½å¼€å…³

### v1.0 åŸºç¡€åŠŸèƒ½
- æ”¯æŒè‡ªå®šä¹‰æ•°æ®ä¿å­˜æ ¼å¼ï¼ˆCSV/Parquetï¼‰
- æ–°å¢æŒ‡æ•°åˆ†é’Ÿæ•°æ®ä¸‹è½½åŠŸèƒ½
- ä¼˜åŒ–åˆ†é’Ÿæ•°æ®ä¸‹è½½ç®—æ³•ï¼Œçªç ´8000æ¡é™åˆ¶
- æ”¹è¿›åå¤æƒç®—æ³•ï¼Œç¡®ä¿å¢é‡æ¨¡å¼æ•°æ®ä¸€è‡´æ€§
- ä»5000+åªè‚¡ç¥¨ä¸­ç­›é€‰å‡ºæ´»è·ƒäº¤æ˜“çš„è‚¡ç¥¨
- é¿å…STè‚¡ç¥¨å’Œé€€å¸‚è‚¡ç¥¨çš„æ•°æ®å¹²æ‰°
- ä¸“æ³¨äºä¸»æµæŠ•èµ„æ ‡çš„çš„åˆ†æ

### ç­›é€‰é…ç½®æ ¸å¿ƒç‰¹æ€§

#### 1. ä¸‰å±‚ç­›é€‰æ¶æ„
```
å…¨å±€é…ç½® (date_ranges)
â”œâ”€â”€ æ¨¡å¼æ§åˆ¶ (update_mode)
â”œâ”€â”€ å…¨å±€é™åˆ¶ (limits)
â””â”€â”€ è‡ªå®šä¹‰ç­›é€‰ (custom_ranges)
    â”œâ”€â”€ è‚¡ç¥¨ç­›é€‰ (stocks)
    â”œâ”€â”€ åŸºé‡‘ç­›é€‰ (funds)
    â””â”€â”€ æŒ‡æ•°ç­›é€‰ (indices)
```

#### 2. æ™ºèƒ½ç­›é€‰é€»è¾‘
- **æ—¥æœŸç­›é€‰**: æ”¯æŒä¸Šå¸‚æ—¥æœŸã€é€€å¸‚æ—¥æœŸçš„ç²¾ç¡®æ§åˆ¶
- **ç±»å‹ç­›é€‰**: æ ¹æ®äº¤æ˜“æ‰€ã€æ¿å—ã€åˆ†ç±»ç­‰ç»´åº¦è¿‡æ»¤
- **è´¨é‡ç­›é€‰**: è‡ªåŠ¨æ’é™¤STè‚¡ç¥¨ã€é€€å¸‚äº§å“ç­‰ä½è´¨é‡æ•°æ®
- **æ•°é‡æ§åˆ¶**: æ”¯æŒå…¨å±€å’Œåˆ†ç±»åˆ«çš„æ•°é‡é™åˆ¶

#### 3. é…ç½®éªŒè¯æœºåˆ¶
- **å­—æ®µå­˜åœ¨æ€§æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹æ•°æ®æºä¸­å­—æ®µçš„å¯ç”¨æ€§
- **ç±»å‹è½¬æ¢å¤„ç†**: æ™ºèƒ½å¤„ç†ä¸åŒæ•°æ®ç±»å‹çš„æ¯”è¾ƒ
- **ç©ºå€¼å¤„ç†**: æ­£ç¡®å¤„ç†ç©ºå€¼å’Œç¼ºå¤±æ•°æ®çš„ç­›é€‰é€»è¾‘

#### 4. å®é™…åº”ç”¨æ•ˆæœ
- **æµ‹è¯•ç¯å¢ƒ**: é€šè¿‡limitså¿«é€ŸéªŒè¯é…ç½®æ•ˆæœ
- **ç”Ÿäº§ç¯å¢ƒ**: æ”¯æŒå…¨é‡ä¸‹è½½å’Œå¢é‡æ›´æ–°
- **é‡åŒ–åˆ†æ**: ç²¾ç¡®ç­›é€‰ç¬¦åˆç­–ç•¥è¦æ±‚çš„æ ‡çš„æ± 

### 3. åˆ†æ‰¹ä¸‹è½½ç­–ç•¥

**å°è§„æ¨¡æµ‹è¯•**ï¼š
```json
"custom_ranges": {
  "stocks": {
    "enabled": true,
    "min_list_date": "20200101",
    "limits": 20                   // åªä¸‹è½½20åªè‚¡ç¥¨è¿›è¡Œæµ‹è¯•
  }
}
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```json
"stock_filter": {
  "min_list_date": "20100101",     // å…¨é‡ä¸‹è½½ç¬¦åˆæ¡ä»¶çš„è‚¡ç¥¨
  "include_delisted": false
}
```

## ç­›é€‰é…ç½®æœ€ä½³å®è·µ

### 1. é¦–æ¬¡ä½¿ç”¨å»ºè®®
- **æµ‹è¯•æ¨¡å¼**ï¼šå…ˆä½¿ç”¨`limits`å‚æ•°é™åˆ¶ä¸‹è½½æ•°é‡
- **é€æ­¥æ‰©å±•**ï¼šéªŒè¯é…ç½®æ­£ç¡®åå†è¿›è¡Œå…¨é‡ä¸‹è½½
- **åˆç†ç­›é€‰**ï¼šæ ¹æ®å®é™…åˆ†æéœ€æ±‚è®¾ç½®ç­›é€‰æ¡ä»¶

### 2. ä¸åŒä½¿ç”¨åœºæ™¯çš„é…ç½®

**é‡åŒ–å›æµ‹åœºæ™¯**ï¼š
```json
{
  "etf_filter": {
    "min_list_date": "20150101",   // å…³æ³¨è¿‘å¹´ä¸Šå¸‚çš„ETF
    "include_delisted": false
  },
  "stock_filter": {
    "min_list_date": "20100101",   // åŒ…å«æ›´å¤šå†å²æ•°æ®
    "include_delisted": false
  }
}
```

**å®æ—¶äº¤æ˜“åœºæ™¯**ï¼š
```json
{
  "etf_filter": {
    "min_list_date": "20200101",   // åªå…³æ³¨æœ€æ–°çš„äº§å“
    "include_delisted": false,
    "delist_exp_date": "20991231"
  }
}
```

### 3. é…ç½®éªŒè¯æ–¹æ³•

**æ£€æŸ¥ç­›é€‰æ•ˆæœ**ï¼š
1. æŸ¥çœ‹ä¸‹è½½æ—¥å¿—ä¸­çš„ç­›é€‰ç»Ÿè®¡ä¿¡æ¯
2. æ£€æŸ¥`reference/`ç›®å½•ä¸‹çš„åŸºç¡€æ•°æ®æ–‡ä»¶
3. éªŒè¯å®é™…ä¸‹è½½çš„æ•°æ®æ•°é‡æ˜¯å¦ç¬¦åˆé¢„æœŸ

**å¸¸è§é—®é¢˜æ’æŸ¥**ï¼š
- å¦‚æœä¸‹è½½æ•°é‡è¿‡å°‘ï¼Œæ£€æŸ¥`min_list_date`æ˜¯å¦è®¾ç½®è¿‡äºä¸¥æ ¼
- å¦‚æœåŒ…å«ä¸éœ€è¦çš„æ•°æ®ï¼Œæ£€æŸ¥`include_delisted`è®¾ç½®æ˜¯å¦æ­£ç¡®
- å¦‚æœCUSTOMæ¨¡å¼ä¸ç”Ÿæ•ˆï¼Œç¡®è®¤`update_mode`è®¾ç½®ä¸º`"custom"`

## ä½¿ç”¨å»ºè®®

1. **åŸºé‡‘ç­›é€‰**: å¯ä»¥ç«‹å³ä½¿ç”¨`delist_date`ç­›é€‰ï¼Œå»ºè®®è®¾ç½®åˆç†çš„æ—¥æœŸæ¥è¿‡æ»¤æ—©æœŸé€€å¸‚çš„åŸºé‡‘

2. **è‚¡ç¥¨å’ŒæŒ‡æ•°ç­›é€‰**: è™½ç„¶å½“å‰æ•°æ®ä¸­æ²¡æœ‰ç›¸å…³å­—æ®µï¼Œä½†ä»£ç å·²ç»å®ç°ï¼Œå½“Tushare APIæä¾›è¿™äº›å­—æ®µæ—¶ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ

3. **é…ç½®æ›´æ–°æ¨¡å¼**: è¿™äº›ç­›é€‰åªåœ¨`update_mode: "custom"`æ—¶ç”Ÿæ•ˆï¼Œåœ¨`full`æˆ–`incremental`æ¨¡å¼ä¸‹ä¸ä¼šä½¿ç”¨

4. **æ€§èƒ½ä¼˜åŒ–**: åˆç†çš„ç­›é€‰é…ç½®å¯ä»¥æ˜¾è‘—å‡å°‘ä¸‹è½½æ—¶é—´å’Œå­˜å‚¨ç©ºé—´éœ€æ±‚

5. **æ•°æ®è´¨é‡**: é€šè¿‡æ’é™¤é€€å¸‚å’Œå³å°†åˆ°æœŸçš„äº§å“ï¼Œæé«˜æ•°æ®åˆ†æçš„æœ‰æ•ˆæ€§

## å®Œæ•´é…ç½®ç¤ºä¾‹

```json
{
  "date_ranges": {
    "update_mode": "custom",
    "custom_ranges": {
      "stocks": {
        "enabled": true,
        "min_list_date": "20100101",
        "delist_date": "",  // æ–°å¢ï¼šé€€å¸‚æ—¥æœŸç­›é€‰
        "limits": 20
      },
      "funds": {
        "enabled": true,
        "min_list_date": "20100101", 
        "delist_date": "20200101",  // æ–°å¢ï¼šåªä¿ç•™2020å¹´åé€€å¸‚æˆ–æœªé€€å¸‚çš„åŸºé‡‘
        "limits": 20
      },
      "indices": {
        "enabled": true,
        "min_list_date": "20150101",
        "exp_date": "",  // æ–°å¢ï¼šåˆ°æœŸæ—¥æœŸç­›é€‰
        "limits": 20
      }
    }
  }
}
``` 